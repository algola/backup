@model PapiroMVC.Models.RollPrintableArticleAutoChanges
@using Mvc.HtmlHelpers
@using MvcContrib.UI.Grid
@using PapiroMVC.Validation

@{
    string strings = "~/Areas/DataBase/Views/Article/Strings";
    ViewBag.Title = (string)@Html.T(strings, "TitleIndex");

    string[] typeOfArticle = new string[4];
    typeOfArticle[0] = (string)@Html.T(strings, "SheetPrintableArticleType");
    typeOfArticle[1] = (string)@Html.T(strings, "RollPrintableArticleType");
    typeOfArticle[2] = (string)@Html.T(strings, "ObjectPrintableArticleType");
    typeOfArticle[3] = (string)@Html.T(strings, "RigidPrintableArticleType");
}

<div id="containerbox"> <!-- Main Page -->

@(Html.jqGrid("ArticleGrid")
    
    .setCaption((string)@Html.T(strings, "RollPrintableArticleGridCaption"))
    .setMultiSelect(true)
        // columns
    .addColumn(new Column("Id")
        .setLabel((string)@Html.T(strings, "OperationsCaption"))
        .setWidth(@Html.T(strings, "OperationsCaptionWidth")==null?60:Convert.ToInt32(@Html.T(strings, "OperationsCaptionWidth")))
        .setCustomFormatter("editArticle")
        .setSortable(false))
    .addColumn(new Column("CodArticle")
        .setLabel((string)@Html.T(strings, "CodArticleCaption"))
        .setWidth(80)
        .setSortable(true))

    .addColumn(new Column("TypeOfMaterial")
        .setLabel((string)@Html.T(strings, "TypeOfMaterialCaption"))        
        .setWidth(100)
        .setSortable(true)
        .setSearch(true))

    .addColumn(new Column("NameOfMaterial")
        .setLabel((string)@Html.T(strings, "NameOfMaterialCaption"))
        .setWidth(100)
        .setSortable(true)
        .setSearch(true))

    .addColumn(new Column("Color")
        .setLabel((string)@Html.T(strings, "ColorCaption"))
        .setWidth(100)
        .setSortable(true)
        .setSearch(true))

    .addColumn(new Column("Weight")
        .setLabel((string)@Html.T(strings, "WeightCaption"))
        .setWidth(45)
        .setSortable(true)
        .setAlign(Align.right)
        .setSearch(true))

    .addColumn(new Column("Width")
        .setLabel((string)@Html.T(strings, "WidthCaption"))
        .setWidth(45)
        .setAlign(Align.right)
        .setSortable(true)
        .setSearch(true))

    .addColumn(new Column("SupplierName")
        .setLabel((string)@Html.T(strings, "SupplierNameCaption"))
        .setSearch(true)
        .setWidth(150))
        
    .addColumn(new Column("CostPerMq")
        .setLabel((string)@Html.T(strings, "CostPerMqCaption"))
        .setTitle(false)
        .setSearch(true)
        .setWidth(45)
        .setAlign(Align.right))

    .addColumn(new Column("CostPerMl")
        .setLabel((string)@Html.T(strings, "CostPerMlCaption"))
        .setSearch(true)
        .setWidth(45)
        .setAlign(Align.right))
        
    .setUrl(Url.Action("RollPrintableArticleList", "Article"))

    .setHeight(300)
    .setRowNum(20)
    .setRowList(new int[] { 10, 20, 50, 100 })
    .setPager("CustomGridAccountPager")
    .setPrint(true)
    .setLoadText("")
    .setAutoWidth(true)
    .setSearchToolbar(true)
    .setViewRecords(true)

    // error handler
    .onLoadError((string)@Html.T(strings, "ErrorLoading"))

    // render the html
    .Render()
)

@Html.ActionLink((string)@Html.T(strings, "CreateRollPrintableArticle"), "CreateRollPrintableArticle",null,new {@class="tbutton smalladd"})
@Html.ActionLink((string)@Html.T(strings, "WizardRollPrintableArticle"), "WizardRollPrintableArticle",null,new {@class="tbutton smalladd"})
<a href="javascript:void(0);" id="linkToChangeDiv" class="tbutton smalltool">@Html.T(strings, "AutoCahngesCaption")</a>

    </div>

<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>

<div id="popupbox">
    <br />
    <div id="rollPrintableArticleAutoChanges">            
        @Html.Partial("_RollPrintableArticleAutoChanges", Model)
    </div>

</div>


<script type="text/javascript">

    $(window).bind('resize', function () {
        $("#ArticleGrid").setGridWidth($("#body-container").width());
    }).trigger('resize');

    $(document).ready(function () {

        HideProcessingMsg();

        $('#popupbox').hide();

        $('#popupBoxClose').click(function () {
            unloadPopupBox();
        });

        $('#containerbox').click(function () {
            unloadPopupBox();
        });

        $('#linkToChangeDiv').click(function (e) {
            e.stopPropagation();
            loadPopupBox();
        });

        $('#popupbox').on("keydown", function (e) {

            if (e.which == 27) {
                unloadPopupBox();
            }
        });

    });

    function unloadPopupBox() {    // TO Unload the Popupbox
        HideProcessingMsg();

        $('#popupbox').fadeOut("fast");
        $("#containerbox").css({ // this is just for style        
            "opacity": "1"
        });
        goToByScroll("#top");
    }

    function loadPopupBox() {    // To Load the Popupbox
        HideProcessingMsg();

        $('#popupbox').fadeIn("fast");
        $("#containerbox").css({ // this is just for style
            //                "opacity": "0.3"
        });
        goToByScroll("#popupbox");

        $.blockUI({
            message: 'Saranno variati i dati solo dei ' + jQuery("#ArticleGrid").jqGrid('getGridParam', 'records') + '  articoli in lista. Per selezionare articoli diversi usare i criteri di ricerca.',
            css: {
                cursor: 'default',
                border: 'none',
                padding: '15px',
                backgroundColor: '#000',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                opacity: .5,
                color: '#fff'
            }
        });
        $('.blockOverlay').attr('title', 'Click to unblock').click($.unblockUI);


        $("#SupplierMaker").focus();
    }

    function goToByScroll(id) {
        // Reove "link" from the ID
        id = id.replace("link", "");

        if (id == "#top") {
            $('html,body').animate({
                scrollTop: 0
            }, 'slow');
        } else {
            // Scroll
            $('html,body').animate({
                scrollTop: $(id).offset().top
            }, 'slow');
        }
    }

</script>


